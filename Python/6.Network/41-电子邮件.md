<!--
title: 41-ç”µå­é‚®ä»¶
sort:
-->

# ç”µå­é‚®ä»¶

## yagmail

> ä¸è¦å¦„æƒ³ç”¨å†…ç½®åº“,å¿«ä½¿ç”¨ yagmail å§ ğŸ¤£

```python
import yagmail

#é“¾æ¥é‚®ç®±æœåŠ¡å™¨
yag = yagmail.SMTP( user="user@126.com", password="1234", host='smtp.126.com')

# é‚®ç®±æ­£æ–‡
contents = ['This is the body, and here is just text http://somedomain/image.png',
            'You can find an audio file attached.', '/local/path/song.mp3']

# å‘é€é‚®ä»¶
yag.send('taaa@126.com', 'subject', contents)
# å…³é—­
yag.close()
```

### é™„åŠ 

```python
# å¤šä¸ªç”¨æˆ·å‘é‚®ä»¶
yag.send(['aa@126.com','bb@qq.com','cc@gmail.com'], 'subject', contents)
# å¸¦é™„ä»¶
yag.send('aaaa@126.com', 'å‘é€é™„ä»¶', contents, ["d://log.txt","d://baidu_img.jpg"])
```

### SMTP å‘é€é‚®ä»¶

ğŸš¦ è¸©äº†å¥½å¤šå‘ï¼Œåœ¨ä¹Ÿä¸æƒ³ç”¨å†…ç½®åº“å‘é‚®ä»¶äº†

> SMTP æ˜¯å‘é€é‚®ä»¶çš„åè®®ï¼ŒPython å†…ç½®å¯¹ SMTP çš„æ”¯æŒï¼Œå¯ä»¥å‘é€çº¯æ–‡æœ¬é‚®ä»¶ã€HTML é‚®ä»¶ä»¥åŠå¸¦é™„ä»¶çš„é‚®ä»¶ã€‚

```python
from email.mime.text import MIMEText

import smtplib

user_addr = ''		# å‘é€è´¦æˆ·
password = ''		# æˆæƒç 
to_addr = ''		# æ¥æ”¶è´¦æˆ·
smtp_server = ''	# ä»£ç†å•†æœåŠ¡å™¨

msg = MIMEText('send by python.', 'plain', 'utf-8')	# è®¾ç½®ä¿¡æ¯
msg['Subject'] = 'test_mail'		# å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™554é”™è¯¯
msg['from'] = 'xx@163.com'
msg['to'] = 'xx@qq.com'

server = smtplib.SMTP(smtp_server, 25)	# è®¾ç½®serveræœåŠ¡å™¨
server.set_debuglevel(0)			# debugä¸“ç”¨
server.login(user_addr, password)	# ç™»å½•STMPæœåŠ¡å™¨
# æˆè´¥åœ¨æ­¤ä¸€ä¸¾å•¦
server.sendmail(user_addr, [to_addr], msg.as_string())
server.quit()	# é€€å‡º

```

- æ›´åŠ å®Œæ•´çš„é‚®ä»¶

  ```python
  from email import encoders
  from email.header import Header
  from email.mime.text import MIMEText
  from email.utils import parseaddr, formataddr

  def _format_addr(s):		# æ ¼å¼åŒ–å‘é€äºº
      name, addr = parseaddr(s)
      return formataddr((Header(name, 'utf-8').encode(), addr))

  msg = MIMEText('hello, send by Python...', 'plain', 'utf-8')
  msg['From'] = _format_addr('Pythonçˆ±å¥½è€… <%s>' % from_addr)
  msg['To'] = _format_addr('ç®¡ç†å‘˜ <%s>' % to_addr)
  msg['Subject'] = Header('æ¥è‡ªSMTPçš„é—®å€™â€¦â€¦', 'utf-8').encode()
  ```

- æºå¸¦é™„ä»¶

  ```python
  from email.mime.text import MIMEText
  from email.mime.base import MIMEBase
  from email.mime.multipart import MIMEMultipart
  from email import encoders

  msg = MIMEMultipart()
  msg.attach(MIMEText('send with file...', 'plain', 'utf-8'))

  # æ·»åŠ é™„ä»¶å°±æ˜¯åŠ ä¸Šä¸€ä¸ªMIMEBaseï¼Œä»æœ¬åœ°è¯»å–ä¸€ä¸ªå›¾ç‰‡:
  with open("E:\My_Project\å›¾åº“\\avatar.jpg", 'rb') as f:
      # è®¾ç½®é™„ä»¶çš„MIMEå’Œæ–‡ä»¶åï¼Œè¿™é‡Œæ˜¯pngç±»å‹:
      mime = MIMEBase('image', 'jpg', filename='å¤´åƒ.png')
      # åŠ ä¸Šå¿…è¦çš„å¤´ä¿¡æ¯:
      mime.add_header('Content-Disposition', 'attachment', filename='å¤´åƒ.png')
      mime.add_header('Content-ID', '<0>')
      mime.add_header('X-Attachment-Id', '0')
      # æŠŠé™„ä»¶çš„å†…å®¹è¯»è¿›æ¥:
      mime.set_payload(f.read())
      # ç”¨Base64ç¼–ç :
      encoders.encode_base64(mime)
      # æ·»åŠ åˆ°MIMEMultipart:
      msg.attach(mime)

  ```
